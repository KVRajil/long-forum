/*!
 * # Semantic UI - State
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
!function(e,t,i,n){"use strict";e.fn.state=function(t){var a,o=e(this),r=o.selector||"",s=("ontouchstart"in i.documentElement,(new Date).getTime()),l=[],c=arguments[0],u="string"==typeof c,d=[].slice.call(arguments,1);return o.each(function(){var i,h=e.isPlainObject(t)?e.extend(!0,{},e.fn.state.settings,t):e.extend({},e.fn.state.settings),p=h.error,m=h.metadata,f=h.className,g=h.namespace,v=h.states,b=h.text,y="."+g,T=g+"-module",k=e(this),C=this,E=k.data(T);i={initialize:function(){i.verbose("Initializing module"),h.automatic&&i.add.defaults(),h.context&&""!==r?e(h.context).on(r,"mouseenter"+y,i.change.text).on(r,"mouseleave"+y,i.reset.text).on(r,"click"+y,i.toggle.state):k.on("mouseenter"+y,i.change.text).on("mouseleave"+y,i.reset.text).on("click"+y,i.toggle.state),i.instantiate()},instantiate:function(){i.verbose("Storing instance of module",i),E=i,k.data(T,i)},destroy:function(){i.verbose("Destroying previous module",E),k.off(y).removeData(T)},refresh:function(){i.verbose("Refreshing selector cache"),k=e(C)},add:{defaults:function(){var a=t&&e.isPlainObject(t.states)?t.states:{};e.each(h.defaults,function(t,o){i.is[t]!==n&&i.is[t]()&&(i.verbose("Adding default states",t,C),e.extend(h.states,o,a))})}},is:{active:function(){return k.hasClass(f.active)},loading:function(){return k.hasClass(f.loading)},inactive:function(){return!k.hasClass(f.active)},state:function(e){return f[e]===n?!1:k.hasClass(f[e])},enabled:function(){return!k.is(h.filter.active)},disabled:function(){return k.is(h.filter.active)},textEnabled:function(){return!k.is(h.filter.text)},button:function(){return k.is(".button:not(a, .submit)")},input:function(){return k.is("input")},progress:function(){return k.is(".ui.progress")}},allow:function(e){i.debug("Now allowing state",e),v[e]=!0},disallow:function(e){i.debug("No longer allowing",e),v[e]=!1},allows:function(e){return v[e]||!1},enable:function(){k.removeClass(f.disabled)},disable:function(){k.addClass(f.disabled)},setState:function(e){i.allows(e)&&k.addClass(f[e])},removeState:function(e){i.allows(e)&&k.removeClass(f[e])},toggle:{state:function(){var t,a;if(i.allows("active")&&i.is.enabled()){if(i.refresh(),e.fn.api!==n)if(t=k.api("get request"),a=k.api("was cancelled"))i.debug("API Request cancelled by beforesend"),h.activateTest=function(){return!1},h.deactivateTest=function(){return!1};else if(t)return void i.listenTo(t);i.change.state()}}},listenTo:function(t){i.debug("API request detected, waiting for state signal",t),t&&(b.loading&&i.update.text(b.loading),e.when(t).then(function(){"resolved"==t.state()?(i.debug("API request succeeded"),h.activateTest=function(){return!0},h.deactivateTest=function(){return!0}):(i.debug("API request failed"),h.activateTest=function(){return!1},h.deactivateTest=function(){return!1}),i.change.state()}))},change:{state:function(){i.debug("Determining state change direction"),i.is.inactive()?i.activate():i.deactivate(),h.sync&&i.sync(),h.onChange.call(C)},text:function(){i.is.textEnabled()&&(i.is.disabled()?(i.verbose("Changing text to disabled text",b.hover),i.update.text(b.disabled)):i.is.active()?b.hover?(i.verbose("Changing text to hover text",b.hover),i.update.text(b.hover)):b.deactivate&&(i.verbose("Changing text to deactivating text",b.deactivate),i.update.text(b.deactivate)):b.hover?(i.verbose("Changing text to hover text",b.hover),i.update.text(b.hover)):b.activate&&(i.verbose("Changing text to activating text",b.activate),i.update.text(b.activate)))}},activate:function(){h.activateTest.call(C)&&(i.debug("Setting state to active"),k.addClass(f.active),i.update.text(b.active),h.onActivate.call(C))},deactivate:function(){h.deactivateTest.call(C)&&(i.debug("Setting state to inactive"),k.removeClass(f.active),i.update.text(b.inactive),h.onDeactivate.call(C))},sync:function(){i.verbose("Syncing other buttons to current state"),i.is.active()?o.not(k).state("activate"):o.not(k).state("deactivate")},get:{text:function(){return h.selector.text?k.find(h.selector.text).text():k.html()},textFor:function(e){return b[e]||!1}},flash:{text:function(e,t,n){var a=i.get.text();i.debug("Flashing text message",e,t),e=e||h.text.flash,t=t||h.flashDuration,n=n||function(){},i.update.text(e),setTimeout(function(){i.update.text(a),n.call(C)},t)}},reset:{text:function(){var e=b.active||k.data(m.storedText),t=b.inactive||k.data(m.storedText);i.is.textEnabled()&&(i.is.active()&&e?(i.verbose("Resetting active text",e),i.update.text(e)):t&&(i.verbose("Resetting inactive text",e),i.update.text(t)))}},update:{text:function(e){var t=i.get.text();e&&e!==t?(i.debug("Updating text",e),h.selector.text?k.data(m.storedText,e).find(h.selector.text).text(e):k.data(m.storedText,e).html(e)):i.debug("Text is already set, ignoring update",e)}},setting:function(t,a){if(i.debug("Changing setting",t,a),e.isPlainObject(t))e.extend(!0,h,t);else{if(a===n)return h[t];h[t]=a}},internal:function(t,a){if(e.isPlainObject(t))e.extend(!0,i,t);else{if(a===n)return i[t];i[t]=a}},debug:function(){h.debug&&(h.performance?i.performance.log(arguments):(i.debug=Function.prototype.bind.call(console.info,console,h.name+":"),i.debug.apply(console,arguments)))},verbose:function(){h.verbose&&h.debug&&(h.performance?i.performance.log(arguments):(i.verbose=Function.prototype.bind.call(console.info,console,h.name+":"),i.verbose.apply(console,arguments)))},error:function(){i.error=Function.prototype.bind.call(console.error,console,h.name+":"),i.error.apply(console,arguments)},performance:{log:function(e){var t,n,a;h.performance&&(t=(new Date).getTime(),a=s||t,n=t-a,s=t,l.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:C,"Execution Time":n})),clearTimeout(i.performance.timer),i.performance.timer=setTimeout(i.performance.display,500)},display:function(){var t=h.name+":",a=0;s=!1,clearTimeout(i.performance.timer),e.each(l,function(e,t){a+=t["Execution Time"]}),t+=" "+a+"ms",r&&(t+=" '"+r+"'"),(console.group!==n||console.table!==n)&&l.length>0&&(console.groupCollapsed(t),console.table?console.table(l):e.each(l,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),l=[]}},invoke:function(t,o,r){var s,l,c,u=E;return o=o||d,r=C||r,"string"==typeof t&&u!==n&&(t=t.split(/[\. ]/),s=t.length-1,e.each(t,function(a,o){var r=a!=s?o+t[a+1].charAt(0).toUpperCase()+t[a+1].slice(1):t;if(e.isPlainObject(u[r])&&a!=s)u=u[r];else{if(u[r]!==n)return l=u[r],!1;if(!e.isPlainObject(u[o])||a==s)return u[o]!==n?(l=u[o],!1):(i.error(p.method,t),!1);u=u[o]}})),e.isFunction(l)?c=l.apply(r,o):l!==n&&(c=l),e.isArray(a)?a.push(c):a!==n?a=[a,c]:c!==n&&(a=c),l}},u?(E===n&&i.initialize(),i.invoke(c)):(E!==n&&E.invoke("destroy"),i.initialize())}),a!==n?a:this},e.fn.state.settings={name:"State",debug:!1,verbose:!1,namespace:"state",performance:!0,onActivate:function(){},onDeactivate:function(){},onChange:function(){},activateTest:function(){return!0},deactivateTest:function(){return!0},automatic:!0,sync:!1,flashDuration:1e3,filter:{text:".loading, .disabled",active:".disabled"},context:!1,error:{beforeSend:"The before send function has cancelled state change",method:"The method you called is not defined."},metadata:{promise:"promise",storedText:"stored-text"},className:{active:"active",disabled:"disabled",error:"error",loading:"loading",success:"success",warning:"warning"},selector:{text:!1},defaults:{input:{disabled:!0,loading:!0,active:!0},button:{disabled:!0,loading:!0,active:!0},progress:{active:!0,success:!0,warning:!0,error:!0}},states:{active:!0,disabled:!0,error:!0,loading:!0,success:!0,warning:!0},text:{disabled:!1,flash:!1,hover:!1,active:!1,inactive:!1,activate:!1,deactivate:!1}}}(jQuery,window,document);