/*!
 * # Semantic UI - Visit
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
!function(e,t,i,n){"use strict";e.visit=e.fn.visit=function(i){var a,o=e(e.isFunction(this)?t:this),r=o.selector||"",s=(new Date).getTime(),l=[],c=arguments[0],u="string"==typeof c,d=[].slice.call(arguments,1);return o.each(function(){var h,p=e.isPlainObject(i)?e.extend(!0,{},e.fn.visit.settings,i):e.extend({},e.fn.visit.settings),m=p.error,f=p.namespace,g=f+"-module",v=e(this),b=e(),y=this,T=v.data(g);h={initialize:function(){p.count?h.store(p.key.count,p.count):p.id?h.add.id(p.id):p.increment&&"increment"!==u&&h.increment(),h.add.display(v),h.instantiate()},instantiate:function(){h.verbose("Storing instance of visit module",h),T=h,v.data(g,h)},destroy:function(){h.verbose("Destroying instance"),v.removeData(g)},increment:function(e){var t=h.get.count(),i=+t+1;e?h.add.id(e):(i>p.limit&&!p.surpass&&(i=p.limit),h.debug("Incrementing visits",i),h.store(p.key.count,i))},decrement:function(e){var t=h.get.count(),i=+t-1;e?h.remove.id(e):(h.debug("Removing visit"),h.store(p.key.count,i))},get:{count:function(){return+h.retrieve(p.key.count)||0},idCount:function(e){return e=e||h.get.ids(),e.length},ids:function(e){var t=[];return e=e||h.retrieve(p.key.ids),"string"==typeof e&&(t=e.split(p.delimiter)),h.verbose("Found visited ID list",t),t},storageOptions:function(e){var t={};return p.expires&&(t.expires=p.expires),p.domain&&(t.domain=p.domain),p.path&&(t.path=p.path),t}},has:{visited:function(t,i){var a=!1;return i=i||h.get.ids(),t!==n&&i&&e.each(i,function(e,i){i==t&&(a=!0)}),a}},set:{count:function(e){h.store(p.key.count,e)},ids:function(e){h.store(p.key.ids,e)}},reset:function(){h.store(p.key.count,0),h.store(p.key.ids,null)},add:{id:function(e){var t=h.retrieve(p.key.ids),i=t===n||""===t?e:t+p.delimiter+e;h.has.visited(e)?h.debug("Unique content already visited, not adding visit",e,t):e===n?h.debug("ID is not defined"):(h.debug("Adding visit to unique content",e),h.store(p.key.ids,i)),h.set.count(h.get.idCount())},display:function(t){var i=e(t);i.length>0&&!e.isWindow(i[0])&&(h.debug("Updating visit count for element",i),b=b.length>0?b.add(i):i)}},remove:{id:function(t){var i=h.get.ids(),a=[];t!==n&&i!==n&&(h.debug("Removing visit to unique content",t,i),e.each(i,function(e,i){i!==t&&a.push(i)}),a=a.join(p.delimiter),h.store(p.key.ids,a)),h.set.count(h.get.idCount())}},check:{limit:function(e){e=e||h.get.count(),p.limit&&(e>=p.limit&&(h.debug("Pages viewed exceeded limit, firing callback",e,p.limit),p.onLimit.call(y,e)),h.debug("Limit not reached",e,p.limit),p.onChange.call(y,e)),h.update.display(e)}},update:{display:function(e){e=e||h.get.count(),b.length>0&&(h.debug("Updating displayed view count",b),b.html(e))}},store:function(i,a){var o=h.get.storageOptions(a);if("localstorage"==p.storageMethod&&t.localStorage!==n)t.localStorage.setItem(i,a),h.debug("Value stored using local storage",i,a);else{if(e.cookie===n)return void h.error(m.noCookieStorage);e.cookie(i,a,o),h.debug("Value stored using cookie",i,a,o)}i==p.key.count&&h.check.limit(a)},retrieve:function(i,a){var o;return"localstorage"==p.storageMethod&&t.localStorage!==n?o=t.localStorage.getItem(i):e.cookie!==n?o=e.cookie(i):h.error(m.noCookieStorage),("undefined"==o||"null"==o||o===n||null===o)&&(o=n),o},setting:function(t,i){if(e.isPlainObject(t))e.extend(!0,p,t);else{if(i===n)return p[t];p[t]=i}},internal:function(t,i){return h.debug("Changing internal",t,i),i===n?h[t]:void(e.isPlainObject(t)?e.extend(!0,h,t):h[t]=i)},debug:function(){p.debug&&(p.performance?h.performance.log(arguments):(h.debug=Function.prototype.bind.call(console.info,console,p.name+":"),h.debug.apply(console,arguments)))},verbose:function(){p.verbose&&p.debug&&(p.performance?h.performance.log(arguments):(h.verbose=Function.prototype.bind.call(console.info,console,p.name+":"),h.verbose.apply(console,arguments)))},error:function(){h.error=Function.prototype.bind.call(console.error,console,p.name+":"),h.error.apply(console,arguments)},performance:{log:function(e){var t,i,n;p.performance&&(t=(new Date).getTime(),n=s||t,i=t-n,s=t,l.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:y,"Execution Time":i})),clearTimeout(h.performance.timer),h.performance.timer=setTimeout(h.performance.display,500)},display:function(){var t=p.name+":",i=0;s=!1,clearTimeout(h.performance.timer),e.each(l,function(e,t){i+=t["Execution Time"]}),t+=" "+i+"ms",r&&(t+=" '"+r+"'"),o.length>1&&(t+=" ("+o.length+")"),(console.group!==n||console.table!==n)&&l.length>0&&(console.groupCollapsed(t),console.table?console.table(l):e.each(l,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),l=[]}},invoke:function(t,i,o){var r,s,l,c=T;return i=i||d,o=y||o,"string"==typeof t&&c!==n&&(t=t.split(/[\. ]/),r=t.length-1,e.each(t,function(i,a){var o=i!=r?a+t[i+1].charAt(0).toUpperCase()+t[i+1].slice(1):t;if(e.isPlainObject(c[o])&&i!=r)c=c[o];else{if(c[o]!==n)return s=c[o],!1;if(!e.isPlainObject(c[a])||i==r)return c[a]!==n?(s=c[a],!1):!1;c=c[a]}})),e.isFunction(s)?l=s.apply(o,i):s!==n&&(l=s),e.isArray(a)?a.push(l):a!==n?a=[a,l]:l!==n&&(a=l),s}},u?(T===n&&h.initialize(),h.invoke(c)):(T!==n&&T.invoke("destroy"),h.initialize())}),a!==n?a:this},e.fn.visit.settings={name:"Visit",debug:!1,verbose:!1,performance:!0,namespace:"visit",increment:!1,surpass:!1,count:!1,limit:!1,delimiter:"&",storageMethod:"localstorage",key:{count:"visit-count",ids:"visit-ids"},expires:30,domain:!1,path:"/",onLimit:function(){},onChange:function(){},error:{method:"The method you called is not defined",missingPersist:"Using the persist setting requires the inclusion of PersistJS",noCookieStorage:"The default storage cookie requires $.cookie to be included."}}}(jQuery,window,document);