/*!
 * # Semantic UI - Form Validation
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
!function(e,t,i,n){"use strict";e.fn.form=function(t){var a,o=e(this),r=o.selector||"",s=(new Date).getTime(),l=[],c=arguments[0],u=arguments[1],d="string"==typeof c,h=[].slice.call(arguments,1);return o.each(function(){var p,m,f,g,v,b,y,T,k,C,E,w,D,I,S,_,R,x,O=e(this),A=this,L=[],N=!1;x={initialize:function(){x.get.settings(),d?(R===n&&x.instantiate(),x.invoke(c)):(x.verbose("Initializing form validation",O,T),x.bindEvents(),x.set.defaults(),x.instantiate())},instantiate:function(){x.verbose("Storing instance of module",x),R=x,O.data(S,x)},destroy:function(){x.verbose("Destroying previous module",R),x.removeEvents(),O.removeData(S)},refresh:function(){x.verbose("Refreshing selector cache"),p=O.find(E.field),m=O.find(E.group),f=O.find(E.message),g=O.find(E.prompt),v=O.find(E.submit),b=O.find(E.clear),y=O.find(E.reset)},submit:function(){x.verbose("Submitting form",O),O.submit()},attachEvents:function(t,i){i=i||"submit",e(t).on("click"+_,function(e){x[i](),e.preventDefault()})},bindEvents:function(){x.verbose("Attaching form events"),O.on("submit"+_,x.validate.form).on("blur"+_,E.field,x.event.field.blur).on("click"+_,E.submit,x.submit).on("click"+_,E.reset,x.reset).on("click"+_,E.clear,x.clear),T.keyboardShortcuts&&O.on("keydown"+_,E.field,x.event.field.keydown),p.each(function(){var t=e(this),i=t.prop("type"),n=x.get.changeEvent(i,t);e(this).on(n+_,x.event.field.change)})},clear:function(){p.each(function(){var t=e(this),i=t.parent(),n=t.closest(m),a=n.find(E.prompt),o=t.data(C.defaultValue)||"",r=i.is(E.uiCheckbox),s=i.is(E.uiDropdown),l=n.hasClass(w.error);l&&(x.verbose("Resetting error on field",n),n.removeClass(w.error),a.remove()),s?(x.verbose("Resetting dropdown value",i,o),i.dropdown("clear")):r?t.prop("checked",!1):(x.verbose("Resetting field value",t,o),t.val(""))})},reset:function(){p.each(function(){var t=e(this),i=t.parent(),a=t.closest(m),o=a.find(E.prompt),r=t.data(C.defaultValue),s=i.is(E.uiCheckbox),l=i.is(E.uiDropdown),c=a.hasClass(w.error);r!==n&&(c&&(x.verbose("Resetting error on field",a),a.removeClass(w.error),o.remove()),l?(x.verbose("Resetting dropdown value",i,r),i.dropdown("restore defaults")):s?(x.verbose("Resetting checkbox value",i,r),t.prop("checked",r)):(x.verbose("Resetting field value",t,r),t.val(r)))})},is:{valid:function(){var t=!0;return x.verbose("Checking if form is valid"),e.each(k,function(e,i){x.validate.field(i)||(t=!1)}),t}},removeEvents:function(){O.off(_),p.off(_),v.off(_),p.off(_)},event:{field:{keydown:function(t){var i=e(this),n=t.which,a={enter:13,escape:27};n==a.escape&&(x.verbose("Escape key pressed blurring field"),i.blur()),!t.ctrlKey&&n==a.enter&&i.is(E.input)&&i.not(E.checkbox).length>0&&(N||(i.one("keyup"+_,x.event.field.keyup),x.submit(),x.debug("Enter pressed on input submitting form")),N=!0)},keyup:function(){N=!1},blur:function(){var t=e(this),i=t.closest(m),n=x.get.validation(t);i.hasClass(w.error)?(x.debug("Revalidating field",t,n),x.validate.field(n)):("blur"==T.on||"change"==T.on)&&x.validate.field(n)},change:function(){var t=e(this),i=t.closest(m);("change"==T.on||i.hasClass(w.error)&&T.revalidate)&&(clearTimeout(x.timer),x.timer=setTimeout(function(){x.debug("Revalidating field",t,x.get.validation(t)),x.validate.field(x.get.validation(t))},T.delay))}}},get:{changeEvent:function(e,t){return"checkbox"==e||"radio"==e||"hidden"==e||t.is("select")?"change":x.get.inputEvent()},inputEvent:function(){return i.createElement("input").oninput!==n?"input":i.createElement("input").onpropertychange!==n?"propertychange":"keyup"},settings:function(){if(e.isPlainObject(t)){var i=Object.keys(t),a=i.length>0?t[i[0]].identifier!==n&&t[i[0]].rules!==n:!1;a?(T=e.extend(!0,{},e.fn.form.settings,u),k=e.extend({},e.fn.form.settings.defaults,t),x.error(T.error.oldSyntax,A),x.verbose("Extending settings from legacy parameters",k,T)):(T=e.extend(!0,{},e.fn.form.settings,t),k=e.extend({},e.fn.form.settings.defaults,T.fields),x.verbose("Extending settings",k,T))}else T=e.fn.form.settings,k=e.fn.form.settings.defaults,x.verbose("Using default form validation",k,T);I=T.namespace,C=T.metadata,E=T.selector,w=T.className,D=T.error,S="module-"+I,_="."+I,R=O.data(S),x.refresh()},field:function(t){return x.verbose("Finding field with identifier",t),p.filter("#"+t).length>0?p.filter("#"+t):p.filter('[name="'+t+'"]').length>0?p.filter('[name="'+t+'"]'):p.filter('[name="'+t+'[]"]').length>0?p.filter('[name="'+t+'[]"]'):p.filter("[data-"+C.validate+'="'+t+'"]').length>0?p.filter("[data-"+C.validate+'="'+t+'"]'):e("<input/>")},fields:function(t){var i=e();return e.each(t,function(e,t){i=i.add(x.get.field(t))}),i},validation:function(t){var i;return k?(e.each(k,function(e,n){x.get.field(n.identifier)[0]==t[0]&&(i=n)}),i||!1):!1},value:function(e){var t,i=[];return i.push(e),t=x.get.values.call(A,i),t[e]},values:function(t){var i=e.isArray(t)?x.get.fields(t):p,n={};return i.each(function(t,i){var a=e(i),o=(a.prop("type"),a.prop("name")),r=a.val(),s=a.is(E.checkbox),l=a.is(E.radio),c=-1!==o.indexOf("[]"),u=s?a.is(":checked"):!1;o&&(c?(o=o.replace("[]",""),n[o]||(n[o]=[]),s?u?n[o].push(!0):n[o].push(!1):n[o].push(r)):l?u&&(n[o]=r):s?u?n[o]=!0:n[o]=!1:n[o]=r)}),n}},has:{field:function(e){return x.verbose("Checking for existence of a field with identifier",e),"string"!=typeof e&&x.error(D.identifier,e),p.filter("#"+e).length>0?!0:p.filter('[name="'+e+'"]').length>0?!0:p.filter("[data-"+C.validate+'="'+e+'"]').length>0?!0:!1}},add:{prompt:function(t,i){var a=x.get.field(t),o=a.closest(m),r=o.children(E.prompt),s=0!==r.length;i="string"==typeof i?[i]:i,x.verbose("Adding field error state",t),o.addClass(w.error),T.inline&&(s||(r=T.templates.prompt(i),r.appendTo(o)),r.html(i[0]),s?x.verbose("Inline errors are disabled, no inline error added",t):T.transition&&e.fn.transition!==n&&O.transition("is supported")?(x.verbose("Displaying error with css transition",T.transition),r.transition(T.transition+" in",T.duration)):(x.verbose("Displaying error with fallback javascript animation"),r.fadeIn(T.duration)))},errors:function(e){x.debug("Adding form error messages",e),f.html(T.templates.error(e))}},remove:{prompt:function(t){var i=x.get.field(t.identifier),a=i.closest(m),o=a.children(E.prompt);a.removeClass(w.error),T.inline&&o.is(":visible")&&(x.verbose("Removing prompt for field",t),T.transition&&e.fn.transition!==n&&O.transition("is supported")?o.transition(T.transition+" out",T.duration,function(){o.remove()}):o.fadeOut(T.duration,function(){o.remove()}))}},set:{success:function(){O.removeClass(w.error).addClass(w.success)},defaults:function(){p.each(function(){var t=e(this),i=t.filter(E.checkbox).length>0,n=i?t.is(":checked"):t.val();t.data(C.defaultValue,n)})},error:function(){O.removeClass(w.success).addClass(w.error)},value:function(e,t){var i={};return i[e]=t,x.set.values.call(A,i)},values:function(t){e.isEmptyObject(t)||e.each(t,function(t,i){var n,a=x.get.field(t),o=a.parent(),r=e.isArray(i),s=o.is(E.uiCheckbox),l=o.is(E.uiDropdown),c=a.is(E.radio)&&s,u=a.length>0;u&&(r&&s?(x.verbose("Selecting multiple",i,a),o.checkbox("uncheck"),e.each(i,function(e,t){n=a.filter('[value="'+t+'"]'),o=n.parent(),n.length>0&&o.checkbox("check")})):c?(x.verbose("Selecting radio value",i,a),a.filter('[value="'+i+'"]').parent(E.uiCheckbox).checkbox("check")):s?(x.verbose("Setting checkbox value",i,o),i===!0?o.checkbox("check"):o.checkbox("uncheck")):l?(x.verbose("Setting dropdown value",i,o),o.dropdown("set selected",i)):(x.verbose("Setting field value",i,a),a.val(i)))})}},validate:{form:function(e){var t=x.get.values();return N?!1:(L=[],x.is.valid()?(x.debug("Form has no validation errors, submitting"),x.set.success(),T.onSuccess.call(A,e,t)):(x.debug("Form has errors"),x.set.error(),T.inline||x.add.errors(L),O.data("moduleApi")!==n&&e.stopImmediatePropagation(),T.onFailure.call(A,L,t)))},field:function(t){var i=x.get.field(t.identifier),a=!0,o=[];return i.prop("disabled")?(x.debug("Field is disabled. Skipping",t.identifier),a=!0):t.optional&&""===e.trim(i.val())?(x.debug("Field is optional and empty. Skipping",t.identifier),a=!0):t.rules!==n&&e.each(t.rules,function(e,i){x.has.field(t.identifier)&&!x.validate.rule(t,i)&&(x.debug("Field is invalid",t.identifier,i.type),o.push(i.prompt),a=!1)}),a?(x.remove.prompt(t,o),T.onValid.call(i),!0):(L=L.concat(o),x.add.prompt(t.identifier,o),T.onInvalid.call(i,o),!1)},rule:function(t,i){var a,o,r,s=x.get.field(t.identifier),l=i.type,c=s.val(),u=l.match(T.regExp.bracket),d=!0;if(c=c===n||""===c||null===c?"":e.trim(c+""),u){if(o=""+u[1],r=l.replace(u[0],""),a=T.rules[r],!e.isFunction(a))return void x.error(D.noRule,r);d=a.call(s,c,o)}else{if(a=T.rules[l],!e.isFunction(a))return void x.error(D.noRule,l);d=a.call(s,c)}return d}},setting:function(t,i){if(e.isPlainObject(t))e.extend(!0,T,t);else{if(i===n)return T[t];T[t]=i}},internal:function(t,i){if(e.isPlainObject(t))e.extend(!0,x,t);else{if(i===n)return x[t];x[t]=i}},debug:function(){T.debug&&(T.performance?x.performance.log(arguments):(x.debug=Function.prototype.bind.call(console.info,console,T.name+":"),x.debug.apply(console,arguments)))},verbose:function(){T.verbose&&T.debug&&(T.performance?x.performance.log(arguments):(x.verbose=Function.prototype.bind.call(console.info,console,T.name+":"),x.verbose.apply(console,arguments)))},error:function(){x.error=Function.prototype.bind.call(console.error,console,T.name+":"),x.error.apply(console,arguments)},performance:{log:function(e){var t,i,n;T.performance&&(t=(new Date).getTime(),n=s||t,i=t-n,s=t,l.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:A,"Execution Time":i})),clearTimeout(x.performance.timer),x.performance.timer=setTimeout(x.performance.display,500)},display:function(){var t=T.name+":",i=0;s=!1,clearTimeout(x.performance.timer),e.each(l,function(e,t){i+=t["Execution Time"]}),t+=" "+i+"ms",r&&(t+=" '"+r+"'"),o.length>1&&(t+=" ("+o.length+")"),(console.group!==n||console.table!==n)&&l.length>0&&(console.groupCollapsed(t),console.table?console.table(l):e.each(l,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),l=[]}},invoke:function(t,i,o){var r,s,l,c=R;return i=i||h,o=A||o,"string"==typeof t&&c!==n&&(t=t.split(/[\. ]/),r=t.length-1,e.each(t,function(i,a){var o=i!=r?a+t[i+1].charAt(0).toUpperCase()+t[i+1].slice(1):t;if(e.isPlainObject(c[o])&&i!=r)c=c[o];else{if(c[o]!==n)return s=c[o],!1;if(!e.isPlainObject(c[a])||i==r)return c[a]!==n?(s=c[a],!1):!1;c=c[a]}})),e.isFunction(s)?l=s.apply(o,i):s!==n&&(l=s),e.isArray(a)?a.push(l):a!==n?a=[a,l]:l!==n&&(a=l),s}},x.initialize()}),a!==n?a:this},e.fn.form.settings={name:"Form",namespace:"form",debug:!1,verbose:!1,performance:!0,fields:!1,keyboardShortcuts:!0,on:"submit",inline:!1,delay:200,revalidate:!0,transition:"scale",duration:200,onValid:function(){},onInvalid:function(){},onSuccess:function(){return!0},onFailure:function(){return!1},metadata:{defaultValue:"default",validate:"validate"},regExp:{bracket:/\[(.*)\]/i,decimal:/^\-?\d*(\.\d+)?$/,email:"[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?",escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,flags:/^\/(.*)\/(.*)?/,integer:/^\-?\d+$/,number:/^\-?\d*(\.\d+)?$/,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/i},selector:{checkbox:'input[type="checkbox"], input[type="radio"]',clear:".clear",field:"input, textarea, select",group:".field",input:"input",message:".error.message",prompt:".prompt.label",radio:'input[type="radio"]',reset:'.reset:not([type="reset"])',submit:'.submit:not([type="submit"])',uiCheckbox:".ui.checkbox",uiDropdown:".ui.dropdown"},className:{error:"error",label:"ui prompt label",pressed:"down",success:"success"},error:{identifier:"You must specify a string identifier for each field",method:"The method you called is not defined.",noRule:"There is no rule matching the one you specified",oldSyntax:"Starting in 2.0 forms now only take a single settings object. Validation settings converted to new syntax automatically."},templates:{error:function(t){var i='<ul class="list">';return e.each(t,function(e,t){i+="<li>"+t+"</li>"}),i+="</ul>",e(i)},prompt:function(t){return e("<div/>").addClass("ui basic red pointing prompt label").html(t[0])}},rules:{empty:function(t){return!(t===n||""===t||e.isArray(t)&&0===t.length)},checked:function(){return e(this).filter(":checked").length>0},email:function(t){var i=new RegExp(e.fn.form.settings.regExp.email,"i");return i.test(t)},url:function(t){return e.fn.form.settings.regExp.url.test(t)},regExp:function(t,i){var n,a=i.match(e.fn.form.settings.regExp.flags);return a&&(i=a.length>=2?a[1]:i,n=a.length>=3?a[2]:""),t.match(new RegExp(i,n))},integer:function(t,i){var a,o,r,s=e.fn.form.settings.regExp.integer;return i===n||""===i||".."===i||(-1==i.indexOf("..")?s.test(i)&&(a=o=i-0):(r=i.split("..",2),s.test(r[0])&&(a=r[0]-0),s.test(r[1])&&(o=r[1]-0))),s.test(t)&&(a===n||t>=a)&&(o===n||o>=t)},decimal:function(t){return e.fn.form.settings.regExp.decimal.test(t)},number:function(t){return e.fn.form.settings.regExp.number.test(t)},is:function(e,t){return t="string"==typeof t?t.toLowerCase():t,e="string"==typeof e?e.toLowerCase():e,e==t},isExactly:function(e,t){return e==t},not:function(e,t){return e="string"==typeof e?e.toLowerCase():e,t="string"==typeof t?t.toLowerCase():t,e!=t},notExactly:function(e,t){return e!=t},contains:function(t,i){return i=i.replace(e.fn.form.settings.regExp.escape,"\\$&"),-1!==t.search(new RegExp(i,"i"))},containsExactly:function(t,i){return i=i.replace(e.fn.form.settings.regExp.escape,"\\$&"),-1!==t.search(new RegExp(i))},doesntContain:function(t,i){return i=i.replace(e.fn.form.settings.regExp.escape,"\\$&"),-1===t.search(new RegExp(i,"i"))},doesntContainExactly:function(t,i){return i=i.replace(e.fn.form.settings.regExp.escape,"\\$&"),-1===t.search(new RegExp(i))},minLength:function(e,t){return e!==n?e.length>=t:!1},length:function(e,t){return e!==n?e.length>=t:!1},exactLength:function(e,t){return e!==n?e.length==t:!1},maxLength:function(e,t){return e!==n?e.length<=t:!1},match:function(t,i){var a;e(this);return e('[data-validate="'+i+'"]').length>0?a=e('[data-validate="'+i+'"]').val():e("#"+i).length>0?a=e("#"+i).val():e('[name="'+i+'"]').length>0?a=e('[name="'+i+'"]').val():e('[name="'+i+'[]"]').length>0&&(a=e('[name="'+i+'[]"]')),a!==n?t.toString()==a.toString():!1},creditCard:function(t,i){var n,a,o={visa:{pattern:/^4/,length:[16]},amex:{pattern:/^3[47]/,length:[15]},mastercard:{pattern:/^5[1-5]/,length:[16]},discover:{pattern:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,length:[16]},unionPay:{pattern:/^(62|88)/,length:[16,17,18,19]},jcb:{pattern:/^35(2[89]|[3-8][0-9])/,length:[16]},maestro:{pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,length:[12,13,14,15,16,17,18,19]},dinersClub:{pattern:/^(30[0-5]|^36)/,length:[14]},laser:{pattern:/^(6304|670[69]|6771)/,length:[16,17,18,19]},visaElectron:{pattern:/^(4026|417500|4508|4844|491(3|7))/,length:[16]}},r={},s=!1,l="string"==typeof i?i.split(","):!1;if("string"==typeof t&&0!==t.length){if(l&&(e.each(l,function(i,n){a=o[n],a&&(r={length:-1!==e.inArray(t.length,a.length),pattern:-1!==t.search(a.pattern)},r.length&&r.pattern&&(s=!0))}),!s))return!1;if(n={number:-1!==e.inArray(t.length,o.unionPay.length),pattern:-1!==t.search(o.unionPay.pattern)},n.number&&n.pattern)return!0;for(var c=t.length,u=0,d=[[0,1,2,3,4,5,6,7,8,9],[0,2,4,6,8,1,3,5,7,9]],h=0;c--;)h+=d[u][parseInt(t.charAt(c),10)],u^=1;return h%10===0&&h>0}},different:function(t,i){var a;e(this);return e('[data-validate="'+i+'"]').length>0?a=e('[data-validate="'+i+'"]').val():e("#"+i).length>0?a=e("#"+i).val():e('[name="'+i+'"]').length>0?a=e('[name="'+i+'"]').val():e('[name="'+i+'[]"]').length>0&&(a=e('[name="'+i+'[]"]')),a!==n?t.toString()!==a.toString():!1},exactCount:function(e,t){return 0==t?""===e:1==t?""!==e&&-1===e.search(","):e.split(",").length==t},minCount:function(e,t){return 0==t?!0:1==t?""!==e:e.split(",").length>=t},maxCount:function(e,t){return 0==t?!1:1==t?-1===e.search(","):e.split(",").length<=t}}}}(jQuery,window,document);